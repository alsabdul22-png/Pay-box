<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayBox</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%23ff3b30;stop-opacity:1' /><stop offset='100%' style='stop-color:%23ff7b6b;stop-opacity:1' /></linearGradient></defs><rect width='256' height='256' fill='url(%23grad)'/><rect x='30' y='40' width='196' height='140' rx='10' fill='%23ffffff' opacity='0.95'/><circle cx='128' cy='200' r='35' fill='%23ff3b30' opacity='0.8'/><text x='128' y='210' font-size='40' font-weight='bold' text-anchor='middle' fill='%23ffffff'>ğŸ’³</text></svg>">
</head>
<body>
    <!-- User Selection Screen -->
    <div id="userSelectionScreen" class="full-screen user-selection-screen">
        <div class="screen-container">
            <div class="screen-header">
                <div class="logo-large">ğŸ’³</div>
                <h1 data-i18n="appName">PayBox</h1>
            </div>
            <div class="screen-content">
                <h2 data-i18n="selectUser">Benutzer auswÃ¤hlen</h2>
                <p class="user-selection-hint" data-i18n="selectUserHint">WÃ¤hlen Sie einen Benutzer fÃ¼r den Kassiervorgang</p>
                <div class="user-buttons-full">
                    <button class="btn-user-full" onclick="selectUser('Ahmed')">ğŸ‘¨â€ğŸ’¼ Ahmed</button>
                    <button class="btn-user-full" onclick="selectUser('Aboud')">ğŸ‘¨â€ğŸ’¼ Aboud</button>
                    <button class="btn-user-full" onclick="selectUser('Jawad')">ğŸ‘¨â€ğŸ’¼ Jawad</button>
                </div>
            </div>
            <div class="screen-footer">
                <div class="language-selector-screen">
                    <select id="languageSelectScreen" onchange="changeLanguage(this.value)">
                        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                        <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Back-Office Dashboard Screen -->
    <div id="backOfficeScreen" class="full-screen backoffice-screen" style="display:none;">
        <div class="screen-container">
            <div class="screen-header">
                <div class="logo-large">ğŸ“Š</div>
                <h1 data-i18n="backOffice">Back-Office</h1>
                <div class="header-controls">
                    <span id="backOfficeUserRole" class="role-badge">Admin</span>
                    <button class="btn-change-password" onclick="showChangePasswordModal()">ğŸ”’ Passwort Ã¤ndern</button>
                    <button class="btn-back-screen" onclick="exitBackOffice()" data-i18n="cancel">â† ZurÃ¼ck</button>
                </div>
            </div>
            <div class="backoffice-nav">
                <button class="nav-btn active" onclick="showBackOfficeTab('dashboard')" data-tab="dashboard">ğŸ“Š Dashboard</button>
                <button class="nav-btn" onclick="showBackOfficeTab('articles')" data-tab="articles">ğŸ“¦ Artikel</button>
                <button class="nav-btn" onclick="showBackOfficeTab('cashier')" data-tab="cashier">ğŸ’° Kasse</button>
                <button class="nav-btn" onclick="showBackOfficeTab('sales')" data-tab="sales">ğŸ“ˆ Verkauf</button>
                <button class="nav-btn" onclick="showBackOfficeTab('inventory')" data-tab="inventory">ğŸ“‹ Lager</button>
                <button class="nav-btn" onclick="showBackOfficeTab('employees')" data-tab="employees">ğŸ‘¥ Team</button>
            </div>
            <div class="screen-content backoffice-content">
                <!-- Dashboard Tab -->
                <div id="dashboardTab" class="backoffice-tab active">
                    <h2 data-i18n="dashboard">Ãœbersicht</h2>
                    <div class="export-buttons">
                        <button class="btn-export" onclick="viewHTMLReport()" title="Report im Browser anzeigen">ğŸ“„ Report anzeigen</button>
                        <button class="btn-export" onclick="printReport()" title="Report drucken">ğŸ–¨ï¸ Drucken</button>
                        <button class="btn-export" onclick="exportReportAsJSON()" title="JSON exportieren">ğŸ“¥ JSON</button>
                        <button class="btn-export" onclick="exportReportAsCSV()" title="CSV exportieren">ğŸ“Š CSV</button>
                    </div>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-label" data-i18n="todaySales">Heutige UmsÃ¤tze</div>
                            <div class="kpi-value" id="kpiTodaySales">â‚¬0,00</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label" data-i18n="todayTransactions">Transaktionen</div>
                            <div class="kpi-value" id="kpiTransactions">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label" data-i18n="avgTicket">Durchschn. Ticket</div>
                            <div class="kpi-value" id="kpiAvgTicket">â‚¬0,00</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label" data-i18n="topProduct">Top Artikel</div>
                            <div class="kpi-value" id="kpiTopProduct">-</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3 data-i18n="salesByEmployee">VerkÃ¤ufe nach Mitarbeiter</h3>
                        <div id="employeeSalesChart" class="employee-chart"></div>
                    </div>
                </div>

                <!-- Artikel Tab -->
                <div id="articlesTab" class="backoffice-tab" style="display:none;">
                    <h2 data-i18n="productManagement">Artikelverwaltung</h2>
                    <div class="article-container">
                        <div class="article-form">
                            <h3 data-i18n="newArticle">Neuer Artikel</h3>
                            <div class="form-group">
                                <label data-i18n="articleName">Artikelname:</label>
                                <input type="text" id="boProductName" placeholder="z.B. Brot">
                            </div>
                            <div class="form-group">
                                <label data-i18n="price">Preis:</label>
                                <input type="number" id="boProductPrice" placeholder="0.00" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label data-i18n="barcode">Barcode (optional):</label>
                                <input type="text" id="boProductBarcode" placeholder="123456789">
                            </div>
                            <div class="form-group">
                                <label data-i18n="category">Kategorie:</label>
                                <select id="boProductCategory">
                                    <option value="food">Lebensmittel</option>
                                    <option value="cheese_meat">KÃ¤se & Fleisch</option>
                                    <option value="vegetables">GemÃ¼se</option>
                                    <option value="drinks">GetrÃ¤nke</option>
                                    <option value="sweets">SÃ¼ÃŸwaren</option>
                                    <option value="other">Sonstiges</option>
                                </select>
                            </div>
                            <button class="btn-primary" onclick="addProductFromBackOffice()" style="width:100%;" data-i18n="addButton">â• Artikel hinzufÃ¼gen</button>
                        </div>
                        <div class="article-list">
                            <h3 data-i18n="articles">Artikel (insgesamt: <span id="articleCount">0</span>)</h3>
                            <input type="text" class="search-input" id="articleSearch" placeholder="Artikel suchen..." onkeyup="filterArticlesList()">
                            <div id="backofficeArticlesList"></div>
                        </div>
                    </div>
                </div>

                <!-- Kassenabrechnung Tab -->
                <div id="cashierTab" class="backoffice-tab" style="display:none;">
                    <h2 data-i18n="cashierReconciliation">Kassenabrechnung</h2>
                    <div class="cashier-form">
                        <div class="form-group">
                            <label data-i18n="register">Kasse/Register:</label>
                            <select id="registerSelect" onchange="updateRegisterSummary()">
                                <option value="1">Register 1</option>
                                <option value="2">Register 2</option>
                                <option value="all">Alle Kassen</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="expectedCash">Erwartetes Bargeld:</label>
                            <input type="number" id="expectedCash" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label data-i18n="actualCash">GezÃ¤hltes Bargeld:</label>
                            <input type="number" id="actualCash" step="0.01" placeholder="0.00" onchange="calculateDifference()">
                        </div>
                        <div class="form-group">
                            <label data-i18n="cardTransactions">Kartentransaktionen:</label>
                            <input type="number" id="cardTransactions" step="0.01" readonly>
                        </div>
                        <div id="differenceAlert" class="alert"></div>
                        <div class="cashier-summary">
                            <div class="summary-item">
                                <span data-i18n="difference">Differenz:</span>
                                <span id="cashDifference" class="difference-value">â‚¬0,00</span>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="saveCashierReconciliation()" data-i18n="saveReconciliation">Abrechnung speichern</button>
                    </div>
                </div>

                <!-- Verkaufsanalyse Tab -->
                <div id="salesTab" class="backoffice-tab" style="display:none;">
                    <h2 data-i18n="salesAnalysis">Verkaufsanalyse</h2>
                    <div class="analysis-filters">
                        <input type="date" id="analysisDateFrom">
                        <input type="date" id="analysisDateTo">
                        <button class="btn-primary" onclick="generateSalesAnalysis()" data-i18n="generate">Generieren</button>
                    </div>
                    <div id="salesAnalysisContent" class="analysis-content"></div>
                </div>

                <!-- Inventar Tab -->
                <div id="inventoryTab" class="backoffice-tab" style="display:none;">
                    <h2 data-i18n="inventoryManagement">Lagerverwaltung</h2>
                    <div class="inventory-form">
                        <input type="text" id="inventorySearch" placeholder="Artikel suchen..." onkeyup="filterInventoryList()">
                        <div id="inventoryList" class="inventory-list"></div>
                    </div>
                </div>

                <!-- Mitarbeiter Tab -->
                <div id="employeesTab" class="backoffice-tab" style="display:none;">
                    <h2 data-i18n="employeeManagement">Mitarbeiterverwaltung</h2>
                    <div id="employeesList" class="employees-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Closing Screen -->
    <div id="dailyClosingScreen" class="full-screen daily-closing-screen">
        <div class="screen-container">
            <div class="screen-header">
                <div class="logo-large">ğŸ’³</div>
                <h1 data-i18n="dailyClosingReport">Tagesabschlussbericht</h1>
            </div>
            <div class="screen-content daily-closing-full">
                <div id="dailyClosingContent" class="daily-closing-report-full"></div>
            </div>
            <div class="screen-footer">
                <button class="btn-back-screen" onclick="backToMainApp()" data-i18n="cancel">ZurÃ¼ck</button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <div class="header">
                <div class="header-top">
                    <div class="logo-container">
                        <div class="logo">ğŸ’³</div>
                        <h1 data-i18n="appName">PayBox</h1>
                    </div>
                                    <div class="header-controls">
                                        <button class="btn-daily-closing" onclick="openDailyClosing()" data-i18n="dailyClosing">ğŸ“Š Tagesabschluss</button>
                                        <button class="btn-about" onclick="showAbout()" data-i18n="about">Info</button>
                                        <button class="btn-user-select" id="currentUserBtn" onclick="changeUser()">ğŸ‘¤ Benutzer</button>
                                        <div class="language-selector">
                                            <select id="languageSelect" onchange="changeLanguage(this.value)">
                                                <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                                                <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                                                <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                            </select>
                                        </div>
                                    </div>
                </div>
                <p class="time" id="time"></p>
            </div>

            <div class="main-content">
                <!-- Linke Seite: Produkte -->
                <div class="products-section">
                    <h2 data-i18n="articles">Artikel</h2>
                    
                    <div class="barcode-scanner">
                        <h3>ğŸ“± Barcode Scan</h3>
                        <input type="text" id="barcodeInput" placeholder="Barcode einscannen..." onkeypress="handleBarcodeInput(event)">
                        <p class="scanner-hint" data-i18n="scanHint">Barcode einscannen oder manuell eingeben</p>
                    </div>
                    
                    <!-- Kategorien-Auswahl -->
                    <div class="categories-bar">
                        <select id="categorySelect" onchange="filterByCategory(this.value)"></select>
                    </div>
                    
                    <div class="category-info" id="categoryInfo" style="margin-bottom:10px;color:#00d4ff;font-weight:500;"></div>
                    
                    <div class="products-grid" id="productsGrid"></div>
                </div>

                <!-- Rechte Seite: Warenkorb -->
                <div class="cart-section">
                    <h2 data-i18n="cart">Warenkorb</h2>
                    <div class="cart-items" id="cartItems">
                        <p class="empty-cart" data-i18n="emptyCart">Warenkorb ist leer</p>
                    </div>

                    <div class="cart-summary">
                        <div class="summary-row total">
                            <span data-i18n="total">Gesamt:</span>
                            <span id="total">â‚¬ 0,00</span>
                        </div>
                    </div>

                    <div class="payment-section">
                        <button class="btn-clear" onclick="clearCart()" data-i18n="cancel">Abbrechen</button>
                        <button class="btn-cash" onclick="checkoutWithPayment('cash')" data-i18n="cash">ğŸ’µ Bargeld</button>
                        <button class="btn-card" onclick="checkoutWithPayment('card')" data-i18n="card">ğŸ’³ Karte</button>
                    </div>
                    
                    <button class="btn-open-cash" onclick="openCash()" data-i18n="openCash">ğŸ”“ Kasse Ã–ffnen</button>
                    <button class="btn-backoffice" onclick="showBackOffice()" data-i18n="backOffice">ğŸ“Š Back-Office</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal fÃ¼r ZahlungsbestÃ¤tigung -->
    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <h2>Quittung</h2>
            <div id="receiptContent"></div>
            <button class="btn-close" onclick="closeReceipt()">OK</button>
        </div>
    </div>

    <!-- Modal fÃ¼r Quittungsfrage -->
    <div id="receiptQuestionModal" class="modal">
        <div class="modal-content">
            <h2 data-i18n="receiptQuestion">Quittung?</h2>
            <p class="receipt-question-text" data-i18n="receiptAsk">MÃ¶chten Sie eine Quittung?</p>
            <div class="receipt-buttons">
                <button class="btn-no" onclick="closeReceiptQuestion(false)" data-i18n="no">âœ• Nein</button>
                <button class="btn-yes" onclick="closeReceiptQuestion(true)" data-i18n="yes">âœ“ Ja, drucken</button>
            </div>
        </div>
    </div>

    <!-- Modal fÃ¼r Back-Office Passwort -->
    <div id="backofficePasswordModal" class="modal">
        <div class="modal-content">
            <h2 data-i18n="backOfficePassword">Back-Office Passwort</h2>
            <p data-i18n="enterBackOfficePassword">Bitte geben Sie das Passwort ein:</p>
            <input type="password" id="backofficePasswordInput" placeholder="Passwort eingeben" onkeypress="handlePasswordKeyPress(event)">
            <div id="passwordError" class="password-error" style="color: #ff3b30; margin-top: 10px; display: none;"></div>
            <div class="password-buttons">
                <button class="btn-cancel" onclick="closeBackofficePasswordModal()" data-i18n="cancel">âœ• Abbrechen</button>
                <button class="btn-ok" onclick="verifyBackofficePassword()" data-i18n="ok">âœ“ OK</button>
            </div>
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
                <p style="color: #aaa; font-size: 0.9em; margin-bottom: 10px;">Oder senden Sie eine Zugriffsanfrage per E-Mail:</p>
                <button class="btn-email" onclick="requestBackofficeAccess()" style="width: 100%; margin-top: 10px;">ğŸ“§ Anfrage an Admin senden</button>
            </div>
        </div>
    </div>

    <!-- Modal fÃ¼r Passwort Ã¤ndern -->
    <div id="changePasswordModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>Passwort Ã¤ndern</h2>
            <div class="form-group">
                <label>Altes Passwort:</label>
                <input type="password" id="changeOldPassword" placeholder="Altes Passwort">
            </div>
            <div class="form-group">
                <label>Neues Passwort:</label>
                <input type="password" id="changeNewPassword" placeholder="Neues Passwort">
            </div>
            <div class="form-group">
                <label>Neues Passwort bestÃ¤tigen:</label>
                <input type="password" id="changeConfirmPassword" placeholder="Neues Passwort bestÃ¤tigen">
            </div>
            <div id="changePasswordError" class="password-error" style="color:#ff3b30; margin-top:10px; display:none;"></div>
            <div class="password-buttons" style="margin-top:12px; display:flex; gap:8px;">
                <button class="btn-cancel" onclick="closeChangePasswordModal()">âœ• Abbrechen</button>
                <button class="btn-ok" onclick="changeBackofficePassword()">âœ“ Passwort Ã¤ndern</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>

<!-- App credit (translatable) -->
<div style="position:fixed;left:8px;right:8px;bottom:8px;z-index:9999;text-align:center;pointer-events:auto;">
    <span style="display:inline-block;padding:6px 10px;background:rgba(0,0,0,0.6);color:#fff;border-radius:8px;font-size:13px;opacity:0.95;" data-i18n="madeBy">Made by Abdulrahman Alshouly</span>
</div>

<!-- About Modal -->
    <div id="aboutModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:520px;min-width:300px;padding:18px;">
        <h2 data-i18n="aboutTitle">About PayBox</h2>
        <p id="aboutBodyText"></p>
        <div style="margin-top:12px; text-align:right;">
            <button class="btn-close" onclick="closeAbout()">OK</button>
        </div>
    </div>
</div>
